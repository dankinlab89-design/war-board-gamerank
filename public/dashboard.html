<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Dashboard - WAR Board GameRank</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ESTILOS DO DASHBOARD - INLINE PARA EVITAR CORS */
        .stat-trend { font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 5px; }
        .stat-label { font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-top: 5px; }
        
        /* P√ìDIOS */
        .podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 20px; margin-top: 30px; padding: 20px; min-height: 200px; }
        .podium-dashboard { display: flex; justify-content: center; align-items: flex-end; gap: 20px; width: 100%; }
        .podium-item { text-align: center; padding: 15px; border-radius: 10px; min-width: 130px; transition: transform 0.3s ease; }
        .podium-item:hover { transform: translateY(-5px); }
        .podium-item.gold { background: linear-gradient(135deg, #ffd700, #ffc400); order: 2; height: 180px; }
        .podium-item.silver { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); order: 1; height: 150px; }
        .podium-item.bronze { background: linear-gradient(135deg, #cd7f32, #b56c28); order: 3; height: 140px; }
        .podium-rank { font-size: 2rem; margin-bottom: 8px; }
        .podium-player { color: #000; }
        .player-name { font-weight: 900; font-size: 1.1rem; margin-bottom: 5px; }
        .player-stats { font-weight: 600; margin-bottom: 6px; font-size: 0.9rem; }
        .player-patente { font-size: 0.8rem; opacity: 0.8; }
        
        /* VENCEDORES MENSAIS */
        .year-selector { display: flex; gap: 10px; align-items: center; margin: 15px 0; }
        .vencedores-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; }
        .mes-card { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .mes-card:hover { border-color: #3b82f6; transform: translateY(-3px); }
        .mes-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .mes-header h4 { color: white; margin: 0; font-size: 0.9rem; }
        .mes-badge { display: inline-flex; width: 25px; height: 25px; align-items: center; justify-content: center; border-radius: 50%; font-size: 0.8rem; }
        .mes-badge.vencedor { background: linear-gradient(135deg, #ffd700, #ffc400); color: #000; }
        .mes-badge.sem-dados { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); }
        .mes-badge.futuro { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .vencedor-nome { color: #ffd700; font-weight: bold; font-size: 1rem; margin-bottom: 8px; }
        .vencedor-stats { display: flex; flex-direction: column; gap: 5px; font-size: 0.85rem; }
        .vitorias { color: #10b981; font-weight: 600; }
        .sem-vencedor { color: rgba(255,255,255,0.5); text-align: center; padding: 15px 0; font-style: italic; font-size: 0.9rem; }
        
        /* 2025 SPECIAL */
        .ranking-anual-2025 { grid-column: 1 / -1; }
        .ano-card { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 20px; border: 2px solid rgba(255,215,0,0.3); }
        .ano-header { text-align: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .ano-header h4 { color: #ffd700; margin: 0; font-size: 1.1rem; }
        .ano-content { display: flex; flex-direction: column; gap: 10px; }
        .ranking-item { display: flex; align-items: center; gap: 15px; padding: 12px 15px; border-radius: 8px; }
        .ranking-item.gold { background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.3); }
        .ranking-item.silver { background: rgba(192,192,192,0.1); border: 1px solid rgba(192,192,192,0.3); }
        .ranking-item.bronze { background: rgba(205,127,50,0.1); border: 1px solid rgba(205,127,50,0.3); }
        .rank { font-size: 1.3rem; width: 35px; text-align: center; }
        .empate-container { display: flex; flex-direction: column; gap: 8px; width: 100%; }
        .empate { display: flex; justify-content: space-between; width: 100%; }
        .nome { font-weight: 600; font-size: 0.95rem; }
        
        /* EXPORTA√á√ÉO */
        .export-buttons { display: flex; gap: 10px; margin: 15px 0; }
        .export-btn { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(40,167,69,0.2); border: 1px solid rgba(40,167,69,0.3); color: #28a745; border-radius: 5px; text-decoration: none; font-weight: 500; transition: all 0.3s ease; cursor: pointer; border: none; font-family: inherit; font-size: 0.85rem; }
        .export-btn:hover { background: rgba(40,167,69,0.3); transform: translateY(-2px); }
        .export-btn.csv { background: rgba(23,162,184,0.2); border-color: rgba(23,162,184,0.3); color: #17a2b8; }
        .export-btn.csv:hover { background: rgba(23,162,184,0.3); }
        .export-btn.json { background: rgba(111,66,193,0.2); border-color: rgba(111,66,193,0.3); color: #6f42c1; }
        .export-btn.json:hover { background: rgba(111,66,193,0.3); }
        
        /* RESPONSIVO */
        @media (max-width: 768px) {
            .podium-dashboard { flex-direction: column; align-items: center; }
            .podium-item { width: 100%; max-width: 200px; height: auto !important; margin-bottom: 10px; order: 0 !important; }
            .vencedores-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
            .export-buttons { flex-direction: column; }
        }
        
        /* LOADING STATES */
        .loading { opacity: 0.6; pointer-events: none; }
        .loading-spinner { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 2px solid rgba(255,255,255,.3); 
            border-radius: 50%; 
            border-top-color: #3b82f6; 
            animation: spin 1s linear infinite; 
            margin-right: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* NOTIFICA√á√ïES */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(40, 167, 69, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 250px;
            max-width: 350px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }
        .notification.error { background: rgba(220, 53, 69, 0.95); }
        .notification-close { background: none; border: none; color: white; font-size: 1.3rem; cursor: pointer; padding: 0; margin-left: 10px; line-height: 1; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        
        /* TABS */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab-btn { 
            padding: 10px 20px; 
            background: rgba(255,255,255,0.05); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: rgba(255,255,255,0.7); 
            border-radius: 6px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn.active { 
            background: rgba(59, 130, 246, 0.2); 
            border-color: #3b82f6; 
            color: white; 
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <!-- Navega√ß√£o -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo">üìä</div>
                <h1>DASHBOARD <span class="nav-subtitle">WAR Board</span></h1>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Quartel</a>
                <a href="dashboard.html" class="nav-link active"><i class="fas fa-chart-bar"></i> Dashboard</a>
                <a href="jogadores.html" class="nav-link"><i class="fas fa-users"></i> Tropas</a>
                <a href="partidas.html" class="nav-link"><i class="fas fa-flag"></i> Batalhas</a>
                <a href="ranking.html" class="nav-link"><i class="fas fa-trophy"></i> Ranking</a>
                <a href="nova-partida-funcional.html" class="nav-btn"><i class="fas fa-plus"></i> Nova Batalha</a>
            </div>
            <button class="nav-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>
    
    <!-- Dashboard Container -->
    <main class="container">
        <!-- Estat√≠sticas R√°pidas -->
        <section class="quick-stats">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-users"></i> TROPAS ATIVAS</h3>
                        <div class="card-icon">üë•</div>
                    </div>
                    <div class="card-body">
                        <div class="stat-number" id="stat-jogadores">0</div>
                        <div class="stat-trend" id="trend-jogadores">100% ativos</div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-flag"></i> BATALHAS TOTAL</h3>
                        <div class="card-icon">üéÆ</div>
                    </div>
                    <div class="card-body">
                        <div class="stat-number" id="stat-partidas">0</div>
                        <div class="stat-trend" id="trend-partidas">0% este m√™s</div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-fire"></i> RECORDE CONSECUTIVAS</h3>
                        <div class="card-icon">üî•</div>
                    </div>
                    <div class="card-body">
                        <div class="stat-number" id="stat-record">0</div>
                        <div class="stat-label" id="record-holder">-</div>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> M√âDIA/BATALHA</h3>
                        <div class="card-icon">üìä</div>
                    </div>
                    <div class="card-body">
                        <div class="stat-number" id="stat-media">0.0</div>
                        <div class="stat-trend">vit√≥rias por jogador</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- P√≥dios -->
        <section class="rankings-section">
            <h2 class="section-title">P√ìDIOS DE BATALHA</h2>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('global')">
                    <i class="fas fa-globe"></i> Global
                </button>
                <button class="tab-btn" onclick="switchTab('mensal')">
                    <i class="fas fa-calendar-alt"></i> Mensal
                </button>
                <button class="tab-btn" onclick="switchTab('performance')">
                    <i class="fas fa-bolt"></i> Performance
                </button>
            </div>
            
            <div class="tab-content active" id="tab-global">
                <div class="podium-container" id="podium-global">
                    <div class="no-data-message">Carregando p√≥dio global...</div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-mensal">
                <div class="podium-container" id="podium-mensal">
                    <div class="no-data-message">Carregando p√≥dio mensal...</div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-performance">
                <div class="podium-container" id="podium-performance">
                    <div class="no-data-message">Carregando p√≥dio performance...</div>
                </div>
            </div>
        </section>

        <!-- Gr√°ficos -->
        <section class="charts-section">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-pie"></i> DISTRIBUI√á√ÉO DE PATENTES</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="chart-patentes" height="200"></canvas>
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-bar"></i> ASSIDUIDADE</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="chart-assiduidade" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vencedores Mensais -->
        <section class="vencedores-section">
            <h2 class="section-title">VENCEDORES MENSAIS</h2>
            
            <div class="year-selector">
                <select id="select-ano" class="form-control">
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
                <span class="selector-info">Selecione o ano</span>
            </div>
            
            <div class="vencedores-grid" id="vencedores-grid">
                <div class="no-data-message">Carregando vencedores...</div>
            </div>
        </section>

        <!-- √öltimas Partidas -->
        <section class="partidas-section">
            <h2 class="section-title">√öLTIMAS 5 BATALHAS</h2>
            
            <div class="table-responsive">
                <table class="table" id="ultimas-partidas">
                    <thead>
                        <tr>
                            <th>DATA</th>
                            <th>VENCEDOR</th>
                            <th>TIPO</th>
                            <th>PARTICIPANTES</th>
                            <th>OBSERVA√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px; color: rgba(255,255,255,0.5);">
                                Carregando batalhas...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">üìä</div>
                    <h3>Dashboard WAR</h3>
                    <p>Sistema de an√°lise em tempo real</p>
                </div>
                
                <div class="footer-links">
                    <h4>AN√ÅLISE</h4>
                    <a href="dashboard.html">Dashboard</a>
                    <a href="ranking.html">Rankings</a>
                    <a href="estatisticas.html">Estat√≠sticas</a>
                </div>
                
                <div class="footer-export">
                    <h4>EXPORTAR DADOS</h4>
                    <div class="export-buttons">
                        <button id="export-jogadores" class="export-btn">
                            <i class="fas fa-file-excel"></i> Jogadores
                        </button>
                        <button id="export-partidas" class="export-btn csv">
                            <i class="fas fa-file-excel"></i> Batalhas
                        </button>
                        <button id="export-estatisticas" class="export-btn json">
                            <i class="fas fa-chart-bar"></i> Estat√≠sticas
                        </button>
                    </div>
                </div>
                
                <div class="footer-info">
                    <h4>ATUALIZA√á√ÉO</h4>
                    <div class="status-indicator online">
                        <span class="status-dot"></span>
                        Sistema Online
                    </div>
                    <p>√öltima atualiza√ß√£o: <span id="last-update">Agora</span></p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 WAR Board GameRank</p>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT INLINE PARA EVITAR ERROS DE CARREGAMENTO -->
    <script>
        // ============ DASHBOARD COMPAT√çVEL COM RENDER ============
        
        // Configura√ß√£o global
        const API_BASE = window.location.origin + '/api';
        let charts = {};
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Dashboard inicializando...');
            
            // Menu mobile
            document.querySelector('.nav-toggle').addEventListener('click', function() {
                document.querySelector('.nav-menu').classList.toggle('active');
            });
            
            // Popular anos
            popularSeletorAnos();
            
            // Carregar dados
            carregarTodosDados();
            
            // Auto-refresh a cada 30s
            setInterval(carregarDadosPrincipais, 30000);
            
            // Atualizar timestamp
            atualizarTimestamp();
            setInterval(atualizarTimestamp, 60000);
        });
        
        // ============ FUN√á√ïES PRINCIPAIS ============
        
        async function carregarTodosDados() {
            try {
                mostrarLoading(true);
                
                await Promise.all([
                    carregarEstatisticas(),
                    carregarPodios(),
                    carregarVencedoresMensais(),
                    carregarUltimasPartidas()
                ]);
                
                await carregarGraficos();
                
                mostrarLoading(false);
                console.log('‚úÖ Todos os dados carregados');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                mostrarNotificacao('Erro ao carregar dados do dashboard', 'error');
                mostrarLoading(false);
            }
        }
        
        function carregarDadosPrincipais() {
            carregarEstatisticas();
            carregarUltimasPartidas();
            atualizarTimestamp();
        }
        
        // ============ CARREGAR ESTAT√çSTICAS ============
        
        async function carregarEstatisticas() {
            try {
                const response = await fetch(`${API_BASE}/estatisticas`);
                const data = await response.json();
                
                if (data.success) {
                    // Usar endpoint antigo se o novo n√£o existir
                    atualizarCardsEstatisticas(data);
                } else {
                    // Fallback para endpoint antigo
                    await carregarEstatisticasFallback();
                }
                
            } catch (error) {
                console.error('Erro estat√≠sticas:', error);
                await carregarEstatisticasFallback();
            }
        }
        
        async function carregarEstatisticasFallback() {
            try {
                // Fallback: usar endpoints b√°sicos
                const [jogadoresRes, partidasRes, rankingRes] = await Promise.all([
                    fetch(`${API_BASE}/jogadores`),
                    fetch(`${API_BASE}/partidas`),
                    fetch(`${API_BASE}/ranking/global`)
                ]);
                
                const jogadores = await jogadoresRes.json();
                const partidas = await partidasRes.json();
                const ranking = await rankingRes.json();
                
                if (jogadores.success && partidas.success) {
                    const totalJogadores = jogadores.jogadores?.length || 0;
                    const totalPartidas = partidas.partidas?.length || 0;
                    
                    // Atualizar cards
                    document.getElementById('stat-jogadores').textContent = totalJogadores;
                    document.getElementById('stat-partidas').textContent = totalPartidas;
                    
                    // Recorde consecutivo (placeholder)
                    document.getElementById('stat-record').textContent = '0';
                    
                    // Record holder do ranking
                    if (ranking.success && ranking.length > 0) {
                        document.getElementById('record-holder').textContent = ranking[0].apelido || '-';
                    }
                    
                    // M√©dia
                    const media = totalJogadores > 0 ? (totalPartidas / totalJogadores).toFixed(1) : '0.0';
                    document.getElementById('stat-media').textContent = media;
                }
                
            } catch (error) {
                console.error('Erro fallback estat√≠sticas:', error);
            }
        }
        
        function atualizarCardsEstatisticas(data) {
            // Ajustar conforme estrutura da sua API
            const stats = data.estatisticas || data;
            
            document.getElementById('stat-jogadores').textContent = stats.total_jogadores || '0';
            document.getElementById('stat-partidas').textContent = stats.total_partidas || '0';
            document.getElementById('stat-record').textContent = stats.record_consecutivo || '0';
            document.getElementById('record-holder').textContent = stats.record_holder_consecutivo || '-';
            
            // Calcular m√©dia simples
            const totalJogadores = parseInt(stats.total_jogadores) || 0;
            const totalPartidas = parseInt(stats.total_partidas) || 0;
            const media = totalJogadores > 0 ? (totalPartidas / totalJogadores).toFixed(1) : '0.0';
            document.getElementById('stat-media').textContent = media;
            
            // Atualizar trends
            document.getElementById('trend-jogadores').textContent = '100% ativos';
            
            // Calcular % do m√™s
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            const partidasEsteMes = stats.partidas_mes_atual || 0;
            const percentualMes = totalPartidas > 0 ? 
                Math.round((partidasEsteMes / totalPartidas) * 100) : 0;
            document.getElementById('trend-partidas').textContent = `${percentualMes}% este m√™s`;
        }
        
        // ============ CARREGAR P√ìDIOS ============
        
        async function carregarPodios() {
            await Promise.all([
                carregarPodioGlobal(),
                carregarPodioMensal(),
                carregarPodioPerformance()
            ]);
        }
        
        async function carregarPodioGlobal() {
            try {
                const response = await fetch(`${API_BASE}/ranking/global`);
                const data = await response.json();
                
                const container = document.getElementById('podium-global');
                if (!container) return;
                
                if (data.success && data.length > 0) {
                    const podio = data.slice(0, 3);
                    renderizarPodio(podio, 'podium-global');
                } else if (data.jogadores) {
                    // Formato alternativo
                    const podio = data.jogadores.slice(0, 3);
                    renderizarPodio(podio, 'podium-global');
                } else {
                    container.innerHTML = '<div class="no-data-message">Sem dados para p√≥dio global</div>';
                }
                
            } catch (error) {
                console.error('Erro p√≥dio global:', error);
            }
        }
        
        async function carregarPodioMensal() {
            try {
                const hoje = new Date();
                const ano = hoje.getFullYear();
                const mes = hoje.getMonth() + 1;
                
                const response = await fetch(`${API_BASE}/ranking/mensal/${ano}/${mes}`);
                const data = await response.json();
                
                const container = document.getElementById('podium-mensal');
                if (!container) return;
                
                if (data.success && data.length > 0) {
                    const podio = data.slice(0, 3);
                    renderizarPodio(podio, 'podium-mensal');
                } else {
                    const mesNome = hoje.toLocaleDateString('pt-BR', { month: 'long' });
                    container.innerHTML = `<div class="no-data-message">Nenhuma partida em ${mesNome}</div>`;
                }
                
            } catch (error) {
                console.error('Erro p√≥dio mensal:', error);
                const container = document.getElementById('podium-mensal');
                if (container) {
                    container.innerHTML = '<div class="no-data-message">Erro ao carregar p√≥dio mensal</div>';
                }
            }
        }
        
        async function carregarPodioPerformance() {
            try {
                // Tentar endpoint de performance ou usar c√°lculo local
                const response = await fetch(`${API_BASE}/jogadores`);
                const data = await response.json();
                
                const container = document.getElementById('podium-performance');
                if (!container) return;
                
                if (data.success && data.jogadores) {
                    const jogadoresComPerformance = data.jogadores
                        .filter(j => j.partidas >= 3) // M√≠nimo 3 partidas
                        .map(j => {
                            const vitorias = j.vitorias || 0;
                            const partidas = j.partidas || 0;
                            const performance = partidas > 0 ? (vitorias / partidas * 100).toFixed(1) : 0;
                            
                            return {
                                apelido: j.apelido,
                                patente: j.patente || 'Cabo ü™ñ',
                                vitorias,
                                partidas,
                                performance
                            };
                        })
                        .sort((a, b) => parseFloat(b.performance) - parseFloat(a.performance))
                        .slice(0, 3);
                    
                    if (jogadoresComPerformance.length > 0) {
                        renderizarPodioPerformance(jogadoresComPerformance);
                    } else {
                        container.innerHTML = '<div class="no-data-message">M√≠nimo 3 partidas para performance</div>';
                    }
                } else {
                    container.innerHTML = '<div class="no-data-message">Sem dados de performance</div>';
                }
                
            } catch (error) {
                console.error('Erro p√≥dio performance:', error);
            }
        }
        
        function renderizarPodio(podio, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const podioCompleto = [
                podio[0] || null,
                podio[1] || null,
                podio[2] || null
            ];
            
            container.innerHTML = `
                <div class="podium-dashboard">
                    <div class="podium-item silver">
                        <div class="podium-rank">ü•à</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[1]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[1]?.vitorias || 0}</span> vit√≥rias
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[1]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item gold">
                        <div class="podium-rank">ü•á</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[0]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[0]?.vitorias || 0}</span> vit√≥rias
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[0]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item bronze">
                        <div class="podium-rank">ü•â</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[2]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[2]?.vitorias || 0}</span> vit√≥rias
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[2]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderizarPodioPerformance(podio) {
            const container = document.getElementById('podium-performance');
            if (!container) return;
            
            const podioCompleto = [
                podio[0] || null,
                podio[1] || null,
                podio[2] || null
            ];
            
            container.innerHTML = `
                <div class="podium-dashboard">
                    <div class="podium-item silver">
                        <div class="podium-rank">ü•à</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[1]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[1]?.performance || 0}%</span>
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[1]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item gold">
                        <div class="podium-rank">ü•á</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[0]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[0]?.performance || 0}%</span>
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[0]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="podium-item bronze">
                        <div class="podium-rank">ü•â</div>
                        <div class="podium-player">
                            <div class="player-name">${podioCompleto[2]?.apelido || '-'}</div>
                            <div class="player-stats">
                                <span>${podioCompleto[2]?.performance || 0}%</span>
                            </div>
                            <div class="player-patente">
                                ${podioCompleto[2]?.patente || 'Cabo ü™ñ'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ============ VENCEDORES MENSAIS ============
        
        async function carregarVencedoresMensais() {
            const anoSelecionado = document.getElementById('select-ano')?.value || new Date().getFullYear();
            
            if (anoSelecionado == 2025) {
                mostrarRankingAnual2025();
                return;
            }
            
            // Para outros anos, tentar endpoint ou mostrar vazio
            try {
                const response = await fetch(`${API_BASE}/vencedores/mensal/${anoSelecionado}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        renderizarVencedoresMensais(data.vencedores, anoSelecionado);
                    } else {
                        renderizarVencedoresVazios(anoSelecionado);
                    }
                } else {
                    renderizarVencedoresVazios(anoSelecionado);
                }
            } catch (error) {
                console.error('Erro vencedores mensais:', error);
                renderizarVencedoresVazios(anoSelecionado);
            }
        }
        
        function mostrarRankingAnual2025() {
            const grid = document.getElementById('vencedores-grid');
            if (!grid) return;
            
            grid.innerHTML = `
                <div class="ranking-anual-2025">
                    <div class="ano-card">
                        <div class="ano-header">
                            <h4>üèÜ 2025 - PRIMEIRO ANO üèÜ</h4>
                        </div>
                        <div class="ano-content">
                            <div class="ranking-item gold">
                                <span class="rank">ü•á</span>
                                <span class="nome">NEY2003</span>
                                <span class="vitorias">30 vit√≥rias</span>
                            </div>
                            <div class="ranking-item silver">
                                <span class="rank">ü•à</span>
                                <div class="empate-container">
                                    <div class="empate">
                                        <span class="nome">PetroIdeal</span>
                                        <span class="vitorias">22 vit√≥rias</span>
                                    </div>
                                    <div class="empate">
                                        <span class="nome">Daniel$80</span>
                                        <span class="vitorias">22 vit√≥rias</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ranking-item bronze">
                                <span class="rank">ü•â</span>
                                <span class="nome">TucaRei</span>
                                <span class="vitorias">21 vit√≥rias</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderizarVencedoresMensais(vencedores, ano) {
            const grid = document.getElementById('vencedores-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const meses = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            meses.forEach((mes, index) => {
                const mesNumero = index + 1;
                const vencedorMes = Array.isArray(vencedores) ? 
                    vencedores.find(v => v.mes === mesNumero || v.mes === mesNumero.toString()) : null;
                
                const card = document.createElement('div');
                card.className = 'mes-card';
                
                if (vencedorMes) {
                    card.innerHTML = `
                        <div class="mes-header">
                            <h4>${mes.toUpperCase()}</h4>
                            <span class="mes-badge vencedor">üèÜ</span>
                        </div>
                        <div class="mes-content">
                            <div class="vencedor-nome">${vencedorMes.jogador_apelido || vencedorMes.apelido}</div>
                            <div class="vencedor-stats">
                                <div class="vitorias">${vencedorMes.vitorias || 0} vit√≥rias</div>
                                <div class="participacoes">${vencedorMes.partidas || 0} partidas</div>
                            </div>
                        </div>
                    `;
                } else if (ano < new Date().getFullYear() || 
                          (ano == new Date().getFullYear() && mesNumero <= new Date().getMonth() + 1)) {
                    card.innerHTML = `
                        <div class="mes-header">
                            <h4>${mes.toUpperCase()}</h4>
                            <span class="mes-badge sem-dados">?</span>
                        </div>
                        <div class="mes-content">
                            <div class="sem-vencedor">Dados n√£o registrados</div>
                        </div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="mes-header">
                            <h4>${mes.toUpperCase()}</h4>
                            <span class="mes-badge futuro">‚û°Ô∏è</span>
                        </div>
                        <div class="mes-content">
                            <div class="sem-vencedor">Aguardando...</div>
                        </div>
                    `;
                }
                
                grid.appendChild(card);
            });
        }
        
        function renderizarVencedoresVazios(ano) {
            const grid = document.getElementById('vencedores-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const meses = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            meses.forEach((mes, index) => {
                const mesNumero = index + 1;
                const card = document.createElement('div');
                card.className = 'mes-card';
                
                card.innerHTML = `
                    <div class="mes-header">
                        <h4>${mes.toUpperCase()}</h4>
                        <span class="mes-badge sem-dados">?</span>
                    </div>
                    <div class="mes-content">
                        <div class="sem-vencedor">Dados n√£o dispon√≠veis</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // ============ √öLTIMAS PARTIDAS ============
        
        async function carregarUltimasPartidas() {
            try {
                const response = await fetch(`${API_BASE}/partidas`);
                const data = await response.json();
                
                const tbody = document.querySelector('#ultimas-partidas tbody');
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                if (data.success && data.partidas) {
                    // √öltimas 5 partidas
                    const ultimas = data.partidas
                        .sort((a, b) => new Date(b.data) - new Date(a.data))
                        .slice(0, 5);
                    
                    ultimas.forEach(partida => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${formatarData(partida.data)}</td>
                            <td><strong style="color: #10b981;">${partida.vencedor}</strong></td>
                            <td><span class="badge ${getBadgeClass(partida.tipo)}">${partida.tipo || 'global'}</span></td>
                            <td>${partida.participantes?.length || 0}</td>
                            <td>${partida.observacoes || '-'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else if (data.length > 0) {
                    // Formato alternativo
                    const ultimas = data
                        .sort((a, b) => new Date(b.data) - new Date(a.data))
                        .slice(0, 5);
                    
                    ultimas.forEach(partida => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${formatarData(partida.data)}</td>
                            <td><strong style="color: #10b981;">${partida.vencedor}</strong></td>
                            <td><span class="badge ${getBadgeClass(partida.tipo)}">${partida.tipo || 'global'}</span></td>
                            <td>${partida.participantes?.length || 0}</td>
                            <td>${partida.observacoes || '-'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.5);">
                                Nenhuma partida registrada
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Erro √∫ltimas partidas:', error);
            }
        }
        
        // ============ GR√ÅFICOS ============
        
        async function carregarGraficos() {
            try {
                await Promise.all([
                    carregarGraficoPatentes(),
                    carregarGraficoAssiduidade()
                ]);
            } catch (error) {
                console.error('Erro gr√°ficos:', error);
            }
        }
        
        async function carregarGraficoPatentes() {
            try {
                // Tentar endpoint espec√≠fico ou usar dados de jogadores
                const response = await fetch(`${API_BASE}/jogadores`);
                const data = await response.json();
                
                const ctx = document.getElementById('chart-patentes');
                if (!ctx) return;
                
                if (charts.patentes) {
                    charts.patentes.destroy();
                }
                
                if (data.success && data.jogadores) {
                    // Contar patentes
                    const contagem = {};
                    data.jogadores.forEach(j => {
                        const patente = j.patente || 'Cabo ü™ñ';
                        contagem[patente] = (contagem[patente] || 0) + 1;
                    });
                    
                    const labels = Object.keys(contagem);
                    const valores = Object.values(contagem);
                    
                    if (labels.length > 0) {
                        charts.patentes = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: valores,
                                    backgroundColor: getCoresPatentes(labels),
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: { position: 'bottom', labels: { color: 'white', font: { size: 11 } } },
                                    tooltip: { callbacks: { label: ctx => `${ctx.label}: ${ctx.raw} jogadores` } }
                                }
                            }
                        });
                    } else {
                        ctx.parentElement.innerHTML = '<div class="sem-vencedor">Sem dados de patentes</div>';
                    }
                } else {
                    ctx.parentElement.innerHTML = '<div class="sem-vencedor">Carregando dados de patentes...</div>';
                }
                
            } catch (error) {
                console.error('Erro gr√°fico patentes:', error);
            }
        }
        
        async function carregarGraficoAssiduidade() {
            try {
                const response = await fetch(`${API_BASE}/jogadores`);
                const data = await response.json();
                
                const ctx = document.getElementById('chart-assiduidade');
                if (!ctx) return;
                
                if (charts.assiduidade) {
                    charts.assiduidade.destroy();
                }
                
                if (data.success && data.jogadores) {
                    // Top 10 por partidas
                    const topJogadores = data.jogadores
                        .sort((a, b) => (b.partidas || 0) - (a.partidas || 0))
                        .slice(0, 10);
                    
                    const labels = topJogadores.map(j => j.apelido);
                    const valores = topJogadores.map(j => j.partidas || 0);
                    
                    if (labels.length > 0) {
                        charts.assiduidade = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Participa√ß√µes',
                                    data: valores,
                                    backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: { beginAtZero: true, ticks: { color: 'rgba(255,255,255,0.7)' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                                    x: { ticks: { color: 'rgba(255,255,255,0.7)', maxRotation: 45 }, grid: { color: 'rgba(255,255,255,0.1)' } }
                                },
                                plugins: { legend: { labels: { color: 'white' } } }
                            }
                        });
                    } else {
                        ctx.parentElement.innerHTML = '<div class="sem-vencedor">Sem dados de participa√ß√£o</div>';
                    }
                } else {
                    ctx.parentElement.innerHTML = '<div class="sem-vencedor">Carregando dados de participa√ß√£o...</div>';
                }
                
            } catch (error) {
                console.error('Erro gr√°fico assiduidade:', error);
            }
        }
        
        // ============ FUN√á√ïES AUXILIARES ============
        
        function getCoresPatentes(patentes) {
            const cores = [
                '#9ca3af', '#10b981', '#3b82f6', '#8b5cf6', '#f59e0b',
                '#ef4444', '#ec4899', '#6366f1', '#14b8a6', '#fbbf24',
                '#dc2626', '#ea580c', '#ca8a04', '#65a30d', '#16a34a',
                '#0d9488', '#0891b2', '#0284c7', '#2563eb', '#4f46e5'
            ];
            return patentes.map((_, i) => cores[i % cores.length]);
        }
        
        function formatarData(dataString) {
            try {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR');
            } catch (e) {
                return dataString;
            }
        }
        
        function getBadgeClass(tipo) {
            const classes = {
                'global': 'badge-primary',
                'campeonato': 'badge-warning',
                'amistosa': 'badge-info',
                'eliminatoria': 'badge-danger'
            };
            return classes[tipo?.toLowerCase()] || 'badge-secondary';
        }
        
        function popularSeletorAnos() {
            const select = document.getElementById('select-ano');
            if (!select) return;
            
            select.innerHTML = '';
            const anoAtual = new Date().getFullYear();
            
            for (let ano = 2025; ano <= anoAtual + 1; ano++) {
                const option = document.createElement('option');
                option.value = ano;
                option.textContent = ano;
                select.appendChild(option);
            }
            
            select.value = anoAtual;
            
            // Adicionar listener
            select.addEventListener('change', carregarVencedoresMensais);
        }
        
        function atualizarTimestamp() {
            const elemento = document.getElementById('last-update');
            if (elemento) {
                elemento.textContent = new Date().toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
        }
        
        function mostrarLoading(mostrar) {
            const botoes = document.querySelectorAll('.export-btn, .tab-btn');
            botoes.forEach(btn => {
                if (mostrar) {
                    btn.classList.add('loading');
                } else {
                    btn.classList.remove('loading');
                }
            });
        }
        
        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${tipo === 'error' ? 'error' : ''}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                    <i class="fas ${tipo === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
                    <span>${mensagem}</span>
                </div>
                <button class="notification-close">&times;</button>
            `;
            
            document.body.appendChild(notification);
            
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            });
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
        
        // ============ FUN√á√ïES DE EXPORTA√á√ÉO ============
        
        document.addEventListener('click', async function(e) {
            if (e.target.closest('.export-btn')) {
                const btn = e.target.closest('.export-btn');
                const tipo = btn.id.replace('export-', '');
                
                try {
                    let endpoint, filename;
                    
                    switch(tipo) {
                        case 'jogadores':
                            endpoint = `${API_BASE}/jogadores`;
                            filename = `jogadores-war-${new Date().toISOString().split('T')[0]}.json`;
                            break;
                        case 'partidas':
                            endpoint = `${API_BASE}/partidas`;
                            filename = `partidas-war-${new Date().toISOString().split('T')[0]}.json`;
                            break;
                        case 'estatisticas':
                            endpoint = `${API_BASE}/estatisticas`;
                            filename = `estatisticas-war-${new Date().toISOString().split('T')[0]}.json`;
                            break;
                        default:
                            return;
                    }
                    
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    mostrarNotificacao(`Dados exportados como ${filename}`);
                    
                } catch (error) {
                    console.error('Erro exporta√ß√£o:', error);
                    mostrarNotificacao('Erro ao exportar dados', 'error');
                }
            }
        });
        
        // ============ FUN√á√ïES DO TEMPLATE ============
        
        window.switchTab = function(tabName) {
            // Remove active de todas as tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Adiciona active na tab selecionada
            const tabBtn = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
            const tabContent = document.getElementById(`tab-${tabName}`);
            
            if (tabBtn) tabBtn.classList.add('active');
            if (tabContent) tabContent.classList.add('active');
            
            // Recarregar dados espec√≠ficos da tab se necess√°rio
            if (tabName === 'global') carregarPodioGlobal();
            if (tabName === 'mensal') carregarPodioMensal();
            if (tabName === 'performance') carregarPodioPerformance();
        };
        
        // ============ INICIALIZA√á√ÉO FINAL ============
        
        console.log('‚úÖ Dashboard pronto para uso!');
        
    </script>
</body>
</html>
