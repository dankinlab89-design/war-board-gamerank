<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ® Batalhas - WAR Board GameRank</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="nav-logo">ðŸŽ®</div>
                <h1>BATALHAS <span class="nav-subtitle">WAR Board</span></h1>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Quartel</a>
                <a href="dashboard.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboard</a>
                <a href="jogadores.html" class="nav-link"><i class="fas fa-users"></i> Tropas</a>
                <a href="partidas.html" class="nav-link active"><i class="fas fa-flag"></i> Batalhas</a>
                <a href="ranking.html" class="nav-link"><i class="fas fa-trophy"></i> Ranking</a>
                <a href="nova-partida-funcional.html" class="nav-btn"><i class="fas fa-plus"></i> Nova Batalha</a>
            </div>
            <button class="nav-toggle"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <main class="container">
        <h2 class="section-title">HISTÃ“RICO DE BATALHAS</h2>
        
        <div id="loading" class="loading" style="text-align: center; padding: 40px;">
            <div class="spinner"></div>
            <p>Carregando batalhas...</p>
        </div>
        
        <div class="table-responsive" id="tabela-container" style="display: none;">
            <table class="table" id="tabela-partidas">
                <thead>
                    <tr>
                        <th>DATA</th>
                        <th>TIPO</th>
                        <th>VENCEDOR</th>
                        <th>PARTICIPANTES</th>
                        <th>OBSERVAÃ‡Ã•ES</th>
                    </tr>
                </thead>
                <tbody id="lista-partidas">
                    <!-- Carregado via JS -->
                </tbody>
            </table>
        </div>
        
        <div id="sem-dados" style="display: none; text-align: center; padding: 40px;">
            <p>Nenhuma batalha registrada ainda.</p>
            <a href="nova-partida-funcional.html" class="btn btn-primary">
                <i class="fas fa-plus"></i> REGISTRAR PRIMEIRA BATALHA
            </a>
        </div>
        
        <div class="text-center" style="margin-top: 40px;">
            <a href="nova-partida-funcional.html" class="btn btn-primary btn-lg">
                <i class="fas fa-plus"></i> REGISTRAR NOVA BATALHA
            </a>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 WAR Board GameRank - Registro de Batalhas</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // Menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                });
            }
            
            // Carregar partidas
            carregarPartidas();
        });
        
        async function carregarPartidas() {
            try {
                const response = await fetch('/api/partidas');
                
                if (!response.ok) {
                    throw new Error(`Erro ${response.status}`);
                }
                
                const partidas = await response.json();
                
                const loading = document.getElementById('loading');
                const tabelaContainer = document.getElementById('tabela-container');
                const semDados = document.getElementById('sem-dados');
                
                if (loading) loading.style.display = 'none';
                
                if (!partidas || partidas.length === 0) {
                    if (semDados) semDados.style.display = 'block';
                    return;
                }
                
                const tbody = document.getElementById('lista-partidas');
                if (tbody) {
                    tbody.innerHTML = '';
                    
                    partidas.forEach(partida => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${formatarData(partida.data)}</td>
                            <td>
                                <span class="badge ${getBadgeClass(partida.tipo)}">
                                    ${partida.tipo || 'global'}
                                </span>
                            </td>
                            <td>
                                <strong style="color: #10b981;">
                                    ${partida.vencedor_nome || `Jogador ${partida.vencedor_id}`}
                                </strong>
                            </td>
                            <td>${formatarParticipantes(partida.participantes)}</td>
                            <td>${partida.observacoes || '-'}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    if (tabelaContainer) tabelaContainer.style.display = 'block';
                }
                
            } catch (error) {
                console.error('Erro ao carregar partidas:', error);
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.innerHTML = `
                        <div class="message message-error">
                            <i class="fas fa-exclamation-circle"></i>
                            Erro ao carregar batalhas. Tente recarregar a pÃ¡gina.
                        </div>
                    `;
                }
            }
        }
        
        function formatarData(dataString) {
            if (!dataString) return '-';
            try {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR');
            } catch {
                return dataString;
            }
        }
        
        function formatarParticipantes(participantes) {
            if (!participantes) return '0';
            if (typeof participantes === 'string') {
                return `${participantes.split(',').length} jogadores`;
            }
            return '1+';
        }
        
        function getBadgeClass(tipo) {
            const classes = {
                'global': 'badge-primary',
                'campeonato': 'badge-warning',
                'amistosa': 'badge-info',
                'eliminatoria': 'badge-danger'
            };
            return classes[tipo] || 'badge-secondary';
        }
    </script>
</body>
</html>
